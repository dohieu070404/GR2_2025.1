###############################################
# Mosquitto config (dev + production-ish defaults)
#
# IMPORTANT (Windows + Docker note)
# --------------------------------
# A common cause of "Connection refused: Not authorized" is mis-scoped
# auth settings when multiple listeners exist.
#
# To make behaviour deterministic we use per_listener_settings=true and
# explicitly set allow_anonymous/password_file/acl_file per listener.
###############################################

persistence true
persistence_location /mosquitto/data/

# Log to container stdout for easy debugging
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
connection_messages true

# Optional extra configs (kept for extensibility).
# NOTE: our entrypoint clears /mosquitto/config/conf.d on boot to avoid
# stale configs persisting across volume reuse.
include_dir /mosquitto/config/conf.d

per_listener_settings true

#############
# MQTT TCP
#############
listener 1883 0.0.0.0
protocol mqtt
allow_anonymous false
password_file /mosquitto/config/passwordfile
acl_file /mosquitto/config/aclfile

#############
# WebSocket
#############
listener 9001 0.0.0.0
protocol websockets
allow_anonymous false
password_file /mosquitto/config/passwordfile
acl_file /mosquitto/config/aclfile
